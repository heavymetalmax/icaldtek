name: ðŸ“… Generate Calendar (Custom)

on:
  workflow_dispatch:
    inputs:
      city:
        description: 'ÐÐ°ÑÐµÐ»ÐµÐ½Ð¸Ð¹ Ð¿ÑƒÐ½ÐºÑ‚ (Ð¼Ñ–ÑÑ‚Ð¾/ÑÐµÐ»Ð¾)'
        required: true
        default: 'Ñ. Ð“Ð¾Ñ€Ð°'
      street:
        description: 'Ð’ÑƒÐ»Ð¸Ñ†Ñ'
        required: true
        default: 'Ð²ÑƒÐ». ÐœÐ¾ÑÑ‚Ð¾Ð²Ð°'
      house:
        description: 'ÐÐ¾Ð¼ÐµÑ€ Ð±ÑƒÐ´Ð¸Ð½ÐºÑƒ'
        required: true
        default: '21'

jobs:
  generate:
    runs-on: ubuntu-latest
    
    steps:
      - name: ðŸ“¥ Ð—Ð°Ð²Ð°Ð½Ñ‚Ð°Ð¶Ð¸Ñ‚Ð¸ ÐºÐ¾Ð´
        uses: actions/checkout@v4
      
      - name: ðŸ“¦ Ð’ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚Ð¸ Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'npm'
      
      - name: ðŸ”§ Ð’ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚Ð¸ Ð·Ð°Ð»ÐµÐ¶Ð½Ð¾ÑÑ‚Ñ–
        run: npm ci
      
      - name: ðŸŽ­ Ð’ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚Ð¸ Playwright Ð±Ñ€Ð°ÑƒÐ·ÐµÑ€Ð¸
        run: npx playwright install --with-deps chromium
      
      - name: âš™ï¸ ÐÐ°Ð»Ð°ÑˆÑ‚ÑƒÐ²Ð°Ñ‚Ð¸ ÐºÐ¾Ð½Ñ„Ñ–Ð³
        run: |
          cat > config.json << EOF
          {
            "address": {
              "city": "${{ github.event.inputs.city }}",
              "street": "${{ github.event.inputs.street }}",
              "house": "${{ github.event.inputs.house }}"
            }
          }
          EOF
          cat config.json
      
      - name: ðŸŽ¬ Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚Ð¸ ÑÐºÑ€Ð¸Ð¿Ñ‚
        run: node index.js
      
      - name: ðŸ“¤ Ð—Ð°Ð²Ð°Ð½Ñ‚Ð°Ð¶Ð¸Ñ‚Ð¸ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚
        uses: actions/upload-artifact@v4
        with:
          name: dtek-calendar-custom
          path: dtek.ics
          retention-days: 7
      
      - name: âœ… Ð“Ð¾Ñ‚Ð¾Ð²Ð¾!
        run: |
          echo "âœ… ÐšÐ°Ð»ÐµÐ½Ð´Ð°Ñ€ Ð´Ð»Ñ Ð°Ð´Ñ€ÐµÑÐ¸ ÑƒÑÐ¿Ñ–ÑˆÐ½Ð¾ Ð·Ð³ÐµÐ½ÐµÑ€Ð¾Ð²Ð°Ð½Ð¸Ð¹!"
          echo "ÐÐ´Ñ€ÐµÑÐ°: ${{ github.event.inputs.city }}, ${{ github.event.inputs.street }}, ${{ github.event.inputs.house }}"
          echo "Ð¤Ð°Ð¹Ð»: dtek.ics"
